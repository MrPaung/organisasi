<!DOCTYPE html>
<html lang="id" x-data="sbHub()" :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SB HUB // Sinar Bhakti</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        [x-cloak] { display: none !important; }
        .dark body { background-color: #0f172a; color: #f1f5f9; }
        .input-box { @apply w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 text-sm rounded-xl focus:ring-2 focus:ring-blue-500 p-3 transition-all; }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { brand: { 500: '#3b82f6', 600: '#2563eb' } } } }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800 antialiased h-screen flex overflow-hidden">

    <aside class="hidden lg:flex w-72 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex-col h-full z-30 shrink-0">
        <div class="p-8">
            <div class="flex items-center gap-3 mb-8">
                <img src="https://lh3.googleusercontent.com/d/1srkfAZxOVGbtNat84k8BDGtWyTtD7ndE" class="w-12 h-12 rounded-lg object-contain bg-white p-1 shadow-sm">
                <div>
                    <h1 class="text-xl font-extrabold dark:text-white leading-none">SB HUB</h1>
                    <p class="text-[10px] text-slate-400 font-bold tracking-widest">SINAR BHAKTI</p>
                </div>
            </div>

            <button @click="darkMode = !darkMode" class="w-full mb-6 flex items-center justify-between p-3 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 transition">
                <span class="text-xs font-bold" x-text="darkMode ? 'Dark Mode' : 'Light Mode'"></span>
                <i class="fas" :class="darkMode ? 'fa-moon text-yellow-400' : 'fa-sun text-orange-500'"></i>
            </button>
        </div>

        <nav class="flex-1 px-4 space-y-2">
            <template x-for="item in navItems" :key="item.id">
                <button @click="activeTab = item.id" 
                    :class="activeTab === item.id ? 'bg-brand-600 text-white shadow-lg shadow-brand-200 dark:shadow-none' : 'text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800'"
                    class="w-full flex items-center gap-4 px-5 py-3.5 rounded-2xl transition-all font-bold group">
                    <i class="fas w-5 text-center" :class="item.icon"></i>
                    <span x-text="item.label"></span>
                </button>
            </template>
        </nav>
    </aside>

    <main class="flex-1 relative h-full overflow-hidden flex flex-col">
        <div class="flex-1 overflow-y-auto p-4 lg:p-10 pb-24">
            
            <div x-show="activeTab === 'dashboard'" x-transition class="space-y-8">
                <div class="relative w-full aspect-[16/9] max-h-[500px] rounded-[2.5rem] overflow-hidden shadow-2xl bg-slate-200">
                    <template x-for="(slide, index) in allDocumentation" :key="index">
                        <div x-show="currentSlide === index" class="absolute inset-0">
                            <img :src="slide.img" class="w-full h-full object-cover">
                        </div>
                    </template>
                    <div x-show="allDocumentation.length === 0" class="absolute inset-0 flex items-center justify-center text-slate-400">
                        <p>Belum ada dokumentasi (Ukuran Frame 1920x1080)</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div @click="activeTab = 'finance'" class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] border border-slate-100 dark:border-slate-800 shadow-sm cursor-pointer hover:scale-105 transition">
                        <p class="text-xs font-bold text-slate-400 uppercase">Total Kas</p>
                        <h3 class="text-2xl font-extrabold text-emerald-600">Rp <span x-text="formatRupiah(balance)"></span></h3>
                    </div>
                    <div @click="activeTab = 'members'" class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] border border-slate-100 dark:border-slate-800 shadow-sm cursor-pointer hover:scale-105 transition">
                        <p class="text-xs font-bold text-slate-400 uppercase">Anggota</p>
                        <div class="flex gap-4 items-end">
                            <h3 class="text-2xl font-extrabold text-brand-600" x-text="members.length"></h3>
                            <p class="text-[10px] text-slate-400 pb-1" x-text="`L: ${genderCount('L')} | P: ${genderCount('P')}`"></p>
                        </div>
                    </div>
                    <div class="lg:col-span-1 bg-indigo-50 dark:bg-indigo-900/20 p-6 rounded-[2rem] cursor-pointer hover:bg-indigo-100 transition" @click="activeTab = 'events'">
                        <p class="text-xs font-bold text-indigo-400 uppercase">Selesai</p>
                        <h3 class="text-2xl font-extrabold text-indigo-700 dark:text-indigo-400" x-text="doneEvents.length"></h3>
                    </div>
                    <div class="lg:col-span-1 bg-amber-50 dark:bg-amber-900/20 p-6 rounded-[2rem] cursor-pointer hover:bg-amber-100 transition" @click="activeTab = 'events'">
                        <p class="text-xs font-bold text-amber-500 uppercase">Mendatang</p>
                        <h3 class="text-2xl font-extrabold text-amber-600" x-text="upcomingEvents.length"></h3>
                    </div>
                </div>
            </div>

            <div x-show="activeTab === 'members'" x-transition>
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-extrabold">Data Anggota</h2>
                    <button @click="openRegisterModal()" class="bg-brand-600 text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-brand-200">
                        <i class="fas fa-plus mr-2"></i>Registrasi
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="m in filteredMembers" :key="m.id">
                        <div @click="openDetailMember(m)" class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 hover:shadow-xl transition cursor-pointer relative group">
                            <div class="flex items-center gap-5">
                                <img :src="m.photo || defaultPhoto" class="w-20 h-20 rounded-3xl object-cover bg-slate-100">
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400" x-text="m.customId"></p>
                                    <h3 class="font-extrabold text-lg leading-tight" x-text="m.name"></h3>
                                    <p class="text-xs font-bold text-brand-600 mt-1 uppercase" x-text="m.role"></p>
                                </div>
                            </div>
                            <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition">
                                <button @click.stop="editMember(m)" class="p-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-600 hover:text-white"><i class="fas fa-edit"></i></button>
                                <button @click.stop="deleteMember(m.id)" class="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-600 hover:text-white"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="activeTab === 'events'" x-transition>
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-extrabold">Manajemen Acara</h2>
                    <button @click="openEventModal()" class="bg-slate-900 dark:bg-white dark:text-slate-900 text-white px-6 py-3 rounded-2xl font-bold">
                        <i class="fas fa-calendar-plus mr-2"></i>Tambah Acara
                    </button>
                </div>

                <div class="space-y-4">
                    <template x-for="evt in sortedEvents" :key="evt.id">
                        <div @click="openDetailEvent(evt)" class="bg-white dark:bg-slate-900 p-6 rounded-3xl border border-slate-100 dark:border-slate-800 flex justify-between items-center cursor-pointer hover:bg-slate-50 transition relative group">
                            <div class="flex gap-6 items-center">
                                <div class="w-14 h-14 bg-slate-100 dark:bg-slate-800 rounded-2xl flex flex-col items-center justify-center font-bold">
                                    <span class="text-xs text-brand-600" x-text="formatDay(evt.date)"></span>
                                    <span class="text-lg" x-text="formatDateNum(evt.date)"></span>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold" x-text="evt.name"></h3>
                                    <p class="text-xs text-slate-500"><i class="fas fa-location-dot mr-1"></i> <span x-text="evt.location"></span></p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="text-right hidden md:block">
                                    <p class="text-xs font-bold text-slate-400">Kehadiran</p>
                                    <p class="font-bold text-brand-600" x-text="`${(evt.attendance || []).length} Peserta`"></p>
                                </div>
                                <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                                    <button @click.stop="editEvent(evt)" class="p-2 bg-blue-50 text-blue-600 rounded-lg"><i class="fas fa-edit"></i></button>
                                    <button @click.stop="deleteEvent(evt.id)" class="p-2 bg-red-50 text-red-600 rounded-lg"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="activeTab === 'finance'" x-transition>
                 <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div class="lg:col-span-5 space-y-6">
                        <div class="bg-gradient-to-br from-slate-900 to-slate-800 dark:from-brand-600 dark:to-brand-900 p-8 rounded-[3rem] text-white shadow-2xl">
                            <p class="text-slate-400 dark:text-white/60 text-xs font-bold uppercase tracking-widest mb-2">Total Saldo Kas</p>
                            <h2 class="text-5xl font-extrabold tracking-tight">Rp <span x-text="formatRupiah(balance)"></span></h2>
                            <div class="grid grid-cols-2 gap-4 mt-8">
                                <div class="bg-white/10 p-4 rounded-2xl">
                                    <p class="text-[10px] uppercase font-bold text-emerald-400">Pemasukan</p>
                                    <p class="text-lg font-bold">Rp <span x-text="formatRupiah(totalIn)"></span></p>
                                </div>
                                <div class="bg-white/10 p-4 rounded-2xl">
                                    <p class="text-[10px] uppercase font-bold text-rose-400">Pengeluaran</p>
                                    <p class="text-lg font-bold">Rp <span x-text="formatRupiah(totalOut)"></span></p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-slate-100 dark:border-slate-800">
                            <h4 class="font-bold mb-4">Catat Transaksi</h4>
                            <div class="flex gap-2 mb-4">
                                <button @click="finForm.type = 'in'" :class="finForm.type === 'in' ? 'bg-emerald-600 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-500'" class="flex-1 py-3 rounded-xl font-bold transition">Masuk</button>
                                <button @click="finForm.type = 'out'" :class="finForm.type === 'out' ? 'bg-rose-600 text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-500'" class="flex-1 py-3 rounded-xl font-bold transition">Keluar</button>
                            </div>
                            <div class="space-y-3">
                                <input type="number" x-model="finForm.amount" class="input-box" placeholder="Nominal">
                                <input type="text" x-model="finForm.desc" class="input-box" placeholder="Keterangan">
                                <input type="date" x-model="finForm.date" class="input-box">
                                <button @click="addTransaction" class="w-full bg-brand-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-brand-200">Simpan Transaksi</button>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-7">
                        <div class="bg-white dark:bg-slate-900 rounded-[3rem] border border-slate-100 dark:border-slate-800 overflow-hidden min-h-[500px]">
                            <div class="p-8 border-b border-slate-50 dark:border-slate-800 flex justify-between items-center">
                                <h3 class="font-extrabold text-xl text-slate-800 dark:text-white">Riwayat Kas</h3>
                                <button class="text-xs font-bold text-brand-600">Lihat Semua</button>
                            </div>
                            <div class="p-4 space-y-2">
                                <template x-for="t in transactions.slice().reverse()" :key="t.id">
                                    <div class="flex items-center justify-between p-5 rounded-3xl hover:bg-slate-50 dark:hover:bg-slate-800 group transition">
                                        <div class="flex items-center gap-4">
                                            <div :class="t.type === 'in' ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'" class="w-12 h-12 rounded-2xl flex items-center justify-center text-xl">
                                                <i class="fas" :class="t.type === 'in' ? 'fa-arrow-trend-up' : 'fa-arrow-trend-down'"></i>
                                            </div>
                                            <div>
                                                <p class="font-bold text-slate-800 dark:text-slate-200" x-text="t.desc"></p>
                                                <p class="text-xs text-slate-400" x-text="formatDisplayDate(t.date)"></p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="font-extrabold text-lg" :class="t.type === 'in' ? 'text-emerald-600' : 'text-rose-600'" x-text="(t.type === 'in' ? '+' : '-') + ' ' + formatRupiah(t.amount)"></p>
                                            <button @click="deleteTransaction(t.id)" class="text-[10px] text-red-400 opacity-0 group-hover:opacity-100 transition">Hapus</button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                 </div>
            </div>

            <div x-show="activeTab === 'structure'" x-transition>
                 <h2 class="text-3xl font-extrabold text-center mb-12">Struktur Organisasi</h2>
                 <div class="flex flex-col items-center gap-12 w-full">
                    <template x-if="getRoleMember('Ketua')">
                        <div class="flex flex-col items-center" @click="openDetailMember(getRoleMember('Ketua'))">
                            <img :src="getRoleMember('Ketua').photo || defaultPhoto" class="w-32 h-32 rounded-full border-4 border-brand-500 shadow-xl object-cover cursor-pointer hover:scale-110 transition">
                            <span class="mt-4 bg-brand-600 text-white px-5 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest">Ketua</span>
                            <h4 class="mt-2 font-extrabold text-xl" x-text="getRoleMember('Ketua').name"></h4>
                        </div>
                    </template>

                    <template x-if="getRoleMember('Wakil Ketua')">
                        <div class="flex flex-col items-center" @click="openDetailMember(getRoleMember('Wakil Ketua'))">
                            <img :src="getRoleMember('Wakil Ketua').photo || defaultPhoto" class="w-28 h-28 rounded-full border-4 border-blue-400 shadow-lg object-cover cursor-pointer hover:scale-110 transition">
                            <span class="mt-3 bg-blue-500 text-white px-4 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest">Wakil Ketua</span>
                            <h4 class="mt-1 font-bold text-lg" x-text="getRoleMember('Wakil Ketua').name"></h4>
                        </div>
                    </template>

                    <div class="flex flex-wrap justify-center gap-16 md:gap-32">
                         <template x-if="getRoleMember('Sekretaris')">
                            <div class="flex flex-col items-center" @click="openDetailMember(getRoleMember('Sekretaris'))">
                                <img :src="getRoleMember('Sekretaris').photo || defaultPhoto" class="w-24 h-24 rounded-full border-4 border-slate-300 object-cover cursor-pointer hover:scale-110 transition">
                                <span class="mt-3 bg-slate-500 text-white px-4 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest">Sekretaris</span>
                                <h4 class="mt-1 font-bold text-base" x-text="getRoleMember('Sekretaris').name"></h4>
                            </div>
                        </template>
                        <template x-if="getRoleMember('Bendahara')">
                            <div class="flex flex-col items-center" @click="openDetailMember(getRoleMember('Bendahara'))">
                                <img :src="getRoleMember('Bendahara').photo || defaultPhoto" class="w-24 h-24 rounded-full border-4 border-slate-300 object-cover cursor-pointer hover:scale-110 transition">
                                <span class="mt-3 bg-slate-500 text-white px-4 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest">Bendahara</span>
                                <h4 class="mt-1 font-bold text-base" x-text="getRoleMember('Bendahara').name"></h4>
                            </div>
                        </template>
                    </div>

                    <div class="w-full border-t dark:border-slate-800 pt-10">
                        <p class="text-center text-xs font-bold text-slate-400 uppercase tracking-[0.3em] mb-10">Jajaran Pengurus Divisi</p>
                        <div class="flex flex-wrap justify-center gap-6">
                            <template x-for="m in pengurusDivisi" :key="m.id">
                                <div @click="openDetailMember(m)" class="bg-white dark:bg-slate-900 px-6 py-4 rounded-3xl border border-slate-100 dark:border-slate-800 flex items-center gap-4 cursor-pointer hover:bg-brand-50 transition">
                                    <img :src="m.photo || defaultPhoto" class="w-12 h-12 rounded-2xl object-cover">
                                    <div>
                                        <p class="font-extrabold text-sm" x-text="m.name"></p>
                                        <p class="text-[10px] font-bold text-brand-600 uppercase" x-text="m.division || 'Pengurus'"></p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="bg-slate-900 dark:bg-brand-600 text-white px-10 py-4 rounded-full font-extrabold shadow-2xl">
                        Total Seluruh Anggota: <span x-text="members.length"></span> Orang
                    </div>
                 </div>
            </div>

            <div x-show="activeTab === 'gallery'" x-transition>
                <h2 class="text-3xl font-extrabold mb-8">Galeri Dokumentasi</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <template x-for="pic in allDocumentation">
                        <div class="aspect-square rounded-3xl overflow-hidden shadow-lg group relative">
                            <img :src="pic.img" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition p-4 flex flex-col justify-end">
                                <p class="text-white text-xs font-bold" x-text="pic.eventName"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

        </div>
    </main>

    <div x-show="modals.member" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4" x-cloak>
        <div class="bg-white dark:bg-slate-900 w-full max-w-2xl rounded-[3rem] p-10 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-extrabold">Formulir Anggota</h3>
                <button @click="modals.member = false" class="text-slate-400 hover:text-red-500">✕ Tutup</button>
            </div>

            <form @submit.prevent="saveMember" class="space-y-6">
                <div class="flex flex-col items-center mb-8">
                    <div class="relative w-32 h-32 rounded-[2.5rem] bg-slate-100 dark:bg-slate-800 overflow-hidden border-2 border-dashed border-slate-300">
                        <img :src="memForm.photo || defaultPhoto" class="w-full h-full object-cover">
                        <input type="file" @change="handleFileUpload($event, 'memForm', 'photo')" class="absolute inset-0 opacity-0 cursor-pointer">
                        <div class="absolute inset-0 flex items-center justify-center bg-black/20 text-white opacity-0 hover:opacity-100 pointer-events-none transition">
                            <i class="fas fa-camera text-2xl"></i>
                        </div>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2 font-bold uppercase">Klik gambar untuk upload</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="text-xs font-bold ml-1 uppercase text-slate-400">Nama Lengkap</label><input x-model="memForm.name" required class="input-box"></div>
                    <div>
                        <label class="text-xs font-bold ml-1 uppercase text-slate-400">Jenis Kelamin</label>
                        <select x-model="memForm.gender" class="input-box" required>
                            <option value="L">Laki-laki</option>
                            <option value="P">Perempuan</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="text-xs font-bold ml-1 uppercase text-slate-400">Tempat Lahir</label><input x-model="memForm.pob" required class="input-box" placeholder="Contoh: Semarang"></div>
                    <div><label class="text-xs font-bold ml-1 uppercase text-slate-400">Tanggal Lahir</label><input type="date" x-model="memForm.dob" required class="input-box"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="text-xs font-bold ml-1 uppercase text-slate-400">RT (1-6)</label>
                        <select x-model="memForm.rt" required class="input-box">
                            <option value="01">RT 01</option>
                            <option value="02">RT 02</option>
                            <option value="03">RT 03</option>
                            <option value="04">RT 04</option>
                            <option value="05">RT 05</option>
                            <option value="06">RT 06</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold ml-1 uppercase text-slate-400">Jabatan</label>
                        <select x-model="memForm.role" class="input-box">
                            <option value="Anggota">Anggota</option>
                            <option value="Ketua">Ketua</option>
                            <option value="Wakil Ketua">Wakil Ketua</option>
                            <option value="Sekretaris">Sekretaris</option>
                            <option value="Bendahara">Bendahara</option>
                            <option value="Pengurus">Pengurus (Divisi)</option>
                        </select>
                    </div>
                </div>

                <div x-show="memForm.role === 'Pengurus'"><label class="text-xs font-bold ml-1 uppercase text-brand-600">Nama Divisi</label><input x-model="memForm.division" class="input-box" placeholder="Keamanan / Konsumsi / dll"></div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="text-xs font-bold ml-1 uppercase text-slate-400">Tanggal Gabung</label><input type="date" x-model="memForm.joinedDate" required class="input-box"></div>
                    <div><label class="text-xs font-bold ml-1 uppercase text-slate-400">Pekerjaan</label><input x-model="memForm.job" class="input-box"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="text-xs font-bold ml-1 uppercase text-slate-400">No. WhatsApp</label><input type="number" x-model="memForm.wa" class="input-box" placeholder="628xxx"></div>
                    <div>
                        <div class="flex justify-between items-center mb-1"><label class="text-xs font-bold uppercase text-slate-400">Social Media</label><button type="button" @click="addSocial" class="text-[10px] text-brand-600 font-bold">+ Tambah</button></div>
                        <template x-for="(s, i) in memForm.socials" :key="i">
                            <div class="flex gap-2 mb-2">
                                <select x-model="s.platform" class="w-1/3 input-box py-1.5 text-xs"><option value="instagram">Instagram</option><option value="tiktok">TikTok</option></select>
                                <input x-model="s.link" class="flex-1 input-box py-1.5 text-xs" placeholder="Username/Link">
                                <button type="button" @click="memForm.socials.splice(i, 1)" class="text-red-400">✕</button>
                            </div>
                        </template>
                    </div>
                </div>

                <button type="submit" class="w-full bg-slate-900 dark:bg-brand-600 text-white py-4 rounded-2xl font-extrabold shadow-xl">Simpan Data Anggota</button>
            </form>
        </div>
    </div>

    <div x-show="modals.detailMember" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4" x-cloak>
        <div class="bg-white dark:bg-slate-900 w-full max-w-lg rounded-[3rem] overflow-hidden shadow-2xl relative">
            <div class="h-32 bg-slate-900 dark:bg-brand-600"></div>
            <div class="px-8 pb-10 -mt-16 text-center">
                <img :src="selectedMember?.photo || defaultPhoto" class="w-32 h-32 rounded-[2.5rem] border-4 border-white dark:border-slate-900 shadow-xl mx-auto object-cover">
                <h2 class="text-3xl font-extrabold mt-6" x-text="selectedMember?.name"></h2>
                <span class="inline-block mt-2 bg-brand-50 text-brand-600 px-4 py-1 rounded-full text-xs font-bold uppercase" x-text="selectedMember?.role"></span>
                
                <div class="grid grid-cols-2 gap-4 mt-8 text-left">
                    <div class="bg-slate-50 dark:bg-slate-800 p-4 rounded-2xl">
                        <p class="text-[10px] text-slate-400 font-bold uppercase">TTL</p>
                        <p class="text-xs font-bold" x-text="`${selectedMember?.pob}, ${formatDisplayDate(selectedMember?.dob)}`"></p>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-800 p-4 rounded-2xl">
                        <p class="text-[10px] text-slate-400 font-bold uppercase">ID Anggota</p>
                        <p class="text-xs font-bold" x-text="selectedMember?.customId"></p>
                    </div>
                </div>

                <div class="mt-8 text-left">
                    <h4 class="text-xs font-bold uppercase text-slate-400 mb-3 ml-1">Riwayat Kehadiran Acara</h4>
                    <div class="space-y-2 max-h-40 overflow-y-auto pr-2">
                        <template x-for="ev in getMemberAttendanceHistory(selectedMember?.id)">
                            <div class="flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-800 rounded-xl">
                                <p class="text-xs font-bold" x-text="ev.name"></p>
                                <span class="text-[10px] text-brand-600 font-bold" x-text="formatDisplayDate(ev.date)"></span>
                            </div>
                        </template>
                        <div x-show="getMemberAttendanceHistory(selectedMember?.id).length === 0" class="text-center py-4 text-xs text-slate-400 italic">Belum pernah mengikuti acara.</div>
                    </div>
                </div>

                <div class="mt-8 flex gap-3">
                    <a :href="'https://wa.me/' + selectedMember?.wa" target="_blank" class="flex-1 py-3.5 bg-green-500 text-white rounded-2xl font-bold flex items-center justify-center gap-2"><i class="fab fa-whatsapp"></i> Hubungi</a>
                    <button @click="modals.detailMember = false" class="px-6 bg-slate-100 dark:bg-slate-800 rounded-2xl font-bold">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <div x-show="modals.event" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4" x-cloak>
        <div class="bg-white dark:bg-slate-900 w-full max-w-md rounded-[3rem] p-8">
            <h3 class="text-2xl font-extrabold mb-6" x-text="eventForm.id ? 'Edit Acara' : 'Buat Acara Baru'"></h3>
            <form @submit.prevent="saveEvent" class="space-y-4">
                <input x-model="eventForm.name" required class="input-box" placeholder="Nama Acara">
                <input type="date" x-model="eventForm.date" required class="input-box">
                <input x-model="eventForm.location" required class="input-box" placeholder="Lokasi">
                <textarea x-model="eventForm.note" class="input-box" placeholder="Catatan/Note" rows="3"></textarea>
                
                <div class="flex gap-3">
                    <button type="button" @click="modals.event = false" class="flex-1 py-3 bg-slate-100 dark:bg-slate-800 font-bold rounded-2xl">Batal</button>
                    <button type="submit" class="flex-1 py-3 bg-slate-900 dark:bg-brand-600 text-white font-bold rounded-2xl shadow-lg">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="modals.detailEvent" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4" x-cloak>
        <div class="bg-white dark:bg-slate-900 w-full max-w-4xl rounded-[3rem] p-10 max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-start mb-10">
                <div>
                    <span class="text-xs font-bold bg-brand-50 text-brand-600 px-4 py-1 rounded-full mb-3 inline-block" x-text="formatDisplayDate(selectedEvent?.date)"></span>
                    <h2 class="text-4xl font-extrabold" x-text="selectedEvent?.name"></h2>
                    <p class="text-slate-500 mt-2 font-medium"><i class="fas fa-location-dot mr-1"></i> <span x-text="selectedEvent?.location"></span></p>
                </div>
                <button @click="modals.detailEvent = false" class="text-slate-400 text-2xl">✕</button>
            </div>

            <div class="flex-1 overflow-hidden flex flex-col md:flex-row gap-10">
                <div class="w-full md:w-1/2">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold">Dokumentasi Acara</h4>
                        <div class="relative">
                            <button class="bg-brand-600 text-white px-3 py-1.5 rounded-xl text-[10px] font-bold">+ Upload</button>
                            <input type="file" @change="handleFileUpload($event, 'selectedEvent', 'docs')" class="absolute inset-0 opacity-0 cursor-pointer">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3 max-h-64 overflow-y-auto pr-2">
                        <template x-for="(d, i) in selectedEvent?.docs">
                            <div class="aspect-video bg-slate-100 rounded-2xl overflow-hidden relative group">
                                <img :src="d" class="w-full h-full object-cover">
                                <button @click="selectedEvent.docs.splice(i, 1); updateEventData(selectedEvent)" class="absolute top-2 right-2 bg-red-500 text-white p-1.5 rounded-lg opacity-0 group-hover:opacity-100 transition"><i class="fas fa-trash"></i></button>
                            </div>
                        </template>
                        <div x-show="!selectedEvent?.docs?.length" class="col-span-2 text-center py-10 border-2 border-dashed border-slate-200 rounded-2xl text-slate-400 italic text-xs">Belum ada foto dokumentasi.</div>
                    </div>
                    <div class="mt-6 p-5 bg-slate-50 dark:bg-slate-800 rounded-[2rem]">
                        <p class="text-xs font-bold text-slate-400 mb-2 uppercase">Catatan Panitia</p>
                        <p class="text-sm font-medium" x-text="selectedEvent?.note || '-'"></p>
                    </div>
                </div>

                <div class="flex-1 flex flex-col bg-slate-50 dark:bg-slate-800/50 rounded-[2.5rem] p-8">
                    <h4 class="font-extrabold mb-6 flex items-center gap-2"><i class="fas fa-clipboard-user text-brand-600"></i> Absensi Peserta</h4>
                    <input x-model="searchAbsen" placeholder="Cari Nama/RT/ID..." class="input-box mb-4 py-2 border-none shadow-sm">
                    
                    <div class="flex-1 overflow-y-auto space-y-2 pr-2">
                        <template x-for="m in filteredAbsen" :key="m.id">
                            <div class="bg-white dark:bg-slate-900 p-3.5 rounded-2xl flex justify-between items-center shadow-sm">
                                <div class="flex items-center gap-3">
                                    <img :src="m.photo || defaultPhoto" class="w-8 h-8 rounded-full object-cover">
                                    <div>
                                        <p class="text-xs font-bold" x-text="m.name"></p>
                                        <p class="text-[9px] text-slate-400" x-text="`RT ${m.rt} | ${m.customId}`"></p>
                                    </div>
                                </div>
                                <button @click="toggleAbsen(selectedEvent.id, m.id)" 
                                    :class="hasAttended(selectedEvent.id, m.id) ? 'bg-green-500 text-white' : 'bg-slate-100 text-slate-400'"
                                    class="px-4 py-1.5 rounded-xl text-[10px] font-bold transition">
                                    <span x-text="hasAttended(selectedEvent.id, m.id) ? 'HADIR' : 'ABSEN'"></span>
                                </button>
                            </div>
                        </template>
                    </div>
                    <div class="mt-6 pt-6 border-t border-slate-200 text-center">
                         <p class="text-xs font-bold text-slate-500">Total Kehadiran: <span class="text-lg text-brand-600 ml-1" x-text="(selectedEvent?.attendance || []).length"></span> Orang</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function sbHub() {
            return {
                darkMode: localStorage.getItem('sb_dark') === 'true',
                activeTab: 'dashboard',
                currentSlide: 0,
                defaultPhoto: 'https://lh3.googleusercontent.com/d/1srkfAZxOVGbtNat84k8BDGtWyTtD7ndE', // 
                navItems: [
                    { id: 'dashboard', label: 'Dashboard', icon: 'fa-home' },
                    { id: 'members', label: 'Data Anggota', icon: 'fa-user-group' },
                    { id: 'events', label: 'Agenda Acara', icon: 'fa-calendar-check' },
                    { id: 'finance', label: 'Keuangan', icon: 'fa-wallet' },
                    { id: 'structure', label: 'Struktur', icon: 'fa-sitemap' },
                    { id: 'gallery', label: 'Dokumentasi', icon: 'fa-images' }
                ],
                
                // DATA
                members: JSON.parse(localStorage.getItem('sb_members')) || [],
                events: JSON.parse(localStorage.getItem('sb_events')) || [],
                transactions: JSON.parse(localStorage.getItem('sb_transactions')) || [],
                
                // MODALS & FORMS
                modals: { member: false, event: false, detailMember: false, detailEvent: false },
                memForm: { id: null, name: '', gender: 'L', pob: '', dob: '', rt: '01', role: 'Anggota', division: '', joinedDate: '', job: '', wa: '', photo: '', socials: [] },
                eventForm: { id: null, name: '', date: '', location: '', note: '', docs: [], attendance: [] },
                finForm: { type: 'in', amount: '', desc: '', date: '' },
                
                selectedMember: null,
                selectedEvent: null,
                searchAbsen: '',

                init() {
                    this.$watch('darkMode', v => {
                        localStorage.setItem('sb_dark', v);
                    });
                    this.$watch('members', v => localStorage.setItem('sb_members', JSON.stringify(v)));
                    this.$watch('events', v => localStorage.setItem('sb_events', JSON.stringify(v)));
                    this.$watch('transactions', v => localStorage.setItem('sb_transactions', JSON.stringify(v)));
                    
                    setInterval(() => {
                        if(this.allDocumentation.length > 0) this.currentSlide = (this.currentSlide + 1) % this.allDocumentation.length;
                    }, 5000);
                },

                // UTILS
                formatRupiah(n) { return new Intl.NumberFormat('id-ID').format(n); },
                formatDisplayDate(d) { if(!d) return '-'; const [y,m,day] = d.split('-'); return `${day}/${m}/${y}`; },
                formatDay(d) { return new Date(d).toLocaleDateString('id-ID', {weekday:'short'}); },
                formatDateNum(d) { return new Date(d).getDate(); },
                genderCount(g) { return this.members.filter(m => m.gender === g).length; },

                // MEMBER ACTIONS
                openRegisterModal() {
                    this.memForm = { id: null, name: '', gender: 'L', pob: '', dob: '', rt: '01', role: 'Anggota', division: '', joinedDate: '', job: '', wa: '', photo: '', socials: [] };
                    this.modals.member = true;
                },
                saveMember() {
                    if(!this.memForm.id) {
                        // AUTO ID LOGIC: YY + RT + SEQ
                        const yy = this.memForm.joinedDate.substring(2,4);
                        const rt = this.memForm.rt;
                        const seq = (this.members.filter(m => m.customId.startsWith(yy+rt)).length + 1).toString().padStart(3, '0');
                        this.memForm.customId = `${yy}${rt}${seq}`;
                        this.memForm.id = Date.now();
                        this.members.push({...this.memForm});
                    } else {
                        const idx = this.members.findIndex(m => m.id === this.memForm.id);
                        this.members[idx] = {...this.memForm};
                    }
                    this.modals.member = false;
                },
                editMember(m) { this.memForm = JSON.parse(JSON.stringify(m)); this.modals.member = true; },
                deleteMember(id) { if(confirm('Hapus anggota ini?')) this.members = this.members.filter(m => m.id !== id); },
                openDetailMember(m) { this.selectedMember = m; this.modals.detailMember = true; },
                get filteredMembers() { return this.members; },

                // EVENT ACTIONS
                openEventModal() {
                    this.eventForm = { id: null, name: '', date: '', location: '', note: '', docs: [], attendance: [] };
                    this.modals.event = true;
                },
                saveEvent() {
                    if(!this.eventForm.id) {
                        this.eventForm.id = Date.now();
                        this.events.push({...this.eventForm});
                    } else {
                        const idx = this.events.findIndex(e => e.id === this.eventForm.id);
                        this.events[idx] = {...this.eventForm};
                    }
                    this.modals.event = false;
                },
                editEvent(e) { this.eventForm = JSON.parse(JSON.stringify(e)); this.modals.event = true; },
                deleteEvent(id) { if(confirm('Hapus acara ini?')) this.events = this.events.filter(e => e.id !== id); },
                openDetailEvent(e) { this.selectedEvent = e; this.modals.detailEvent = true; },
                updateEventData(e) { const idx = this.events.findIndex(ev => ev.id === e.id); this.events[idx] = {...e}; this.events = [...this.events]; },

                // ATTENDANCE LOGIC
                toggleAbsen(eventId, memberId) {
                    const idx = this.events.findIndex(e => e.id === eventId);
                    let att = this.events[idx].attendance || [];
                    if(att.includes(memberId)) att = att.filter(id => id !== memberId);
                    else att.push(memberId);
                    this.events[idx].attendance = att;
                    this.events = [...this.events];
                },
                hasAttended(eventId, memberId) {
                    return (this.events.find(e => e.id === eventId)?.attendance || []).includes(memberId);
                },
                getMemberAttendanceHistory(memberId) {
                    return this.events.filter(e => (e.attendance || []).includes(memberId));
                },
                get filteredAbsen() {
                    const q = this.searchAbsen.toLowerCase();
                    return this.members.filter(m => m.name.toLowerCase().includes(q) || m.customId.includes(q) || m.rt.includes(q));
                },

                // FINANCE
                addTransaction() {
                    if(!this.finForm.amount || !this.finForm.desc) return;
                    this.transactions.push({...this.finForm, id: Date.now()});
                    this.finForm = { type: 'in', amount: '', desc: '', date: '' };
                },
                deleteTransaction(id) { this.transactions = this.transactions.filter(t => t.id !== id); },
                get balance() { return this.totalIn - this.totalOut; },
                get totalIn() { return this.transactions.filter(t => t.type === 'in').reduce((a,b) => a + Number(b.amount), 0); },
                get totalOut() { return this.transactions.filter(t => t.type === 'out').reduce((a,b) => a + Number(b.amount), 0); },

                // PHOTO HANDLER
                handleFileUpload(e, targetObj, field) {
                    const file = e.target.files[0];
                    if(!file) return;
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        if(field === 'docs') {
                            if(!this[targetObj].docs) this[targetObj].docs = [];
                            this[targetObj].docs.push(ev.target.result);
                            this.updateEventData(this[targetObj]);
                        } else {
                            this[targetObj][field] = ev.target.result;
                        }
                    };
                    reader.readAsDataURL(file);
                },
                addSocial() { this.memForm.socials.push({platform: 'instagram', link: ''}); },

                // ORGANISASI LOGIC
                getRoleMember(r) { return this.members.find(m => m.role === r); },
                get pengurusDivisi() { return this.members.filter(m => m.role === 'Pengurus'); },
                
                // EVENT STATUS LOGIC
                get sortedEvents() { return [...this.events].sort((a,b) => new Date(b.date) - new Date(a.date)); },
                get doneEvents() { return this.events.filter(e => new Date(e.date) < new Date()); },
                get upcomingEvents() { return this.events.filter(e => new Date(e.date) >= new Date().setHours(0,0,0,0)); },
                get allDocumentation() {
                    let d = [];
                    this.events.forEach(e => { if(e.docs) e.docs.forEach(img => d.push({img, eventName: e.name})); });
                    return d;
                }
            }
        }
    </script>
</body>
</html>
